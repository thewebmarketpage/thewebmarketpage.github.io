<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Render</title>
    <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime"></script>
    <script src="https://cdn.jsdelivr.net/npm/twind"></script>
    <style>
        body { font-family: sans-serif; }
        textarea { width: 100%; height: 200px; }
        iframe { width: 100%; height: 100vh; border: none; }
        .hidden { display: none; }
    </style>
</head>
<body id="container" class="bg-gray-900 text-white flex flex-col items-center p-4">
    <h1 class="text-2xl font-bold">Fetch and Render HTML</h1>
    <button class="bg-blue-500 px-4 py-2 rounded mt-4" onclick="fetchAndRender()">Fetch & Render</button>
    <textarea id="htmlContent" class="mt-4 hidden"></textarea>
    <p id="shareLink" class="mt-4 text-sm text-gray-300 hidden"></p>
    <iframe id="preview" class="mt-4"></iframe>

    <script>
        const url = 'https://raw.githubusercontent.com/thewebmarketpage/thewebmarketpage.github.io/refs/heads/root/thewebsitemarket/templates/template1.html';

        async function fetchAndRender() {
            try {
                let response = await fetch(url);
                let text = await response.text();

                // Find the wanted text
                let startIndex = text.indexOf('<!DOCTYPE html>');
                if (startIndex !== -1) {
                    text = text.substring(startIndex);
                } else {
                    alert('Wanted text not found.');
                    return;
                }

                // Remove "create folder" form if present
                text = text.replace(/<form[^>]*>[\s\S]*?create folder[\s\S]*?<\/form>/gi, '');

                document.getElementById('htmlContent').value = text;
                renderHTML(text);
                
                // Generate a unique URL
                let id = btoa(text).substring(0, 10); // Short hash
                let shareURL = `${window.location.origin}${window.location.pathname}?id=${id}`;
                history.pushState(null, "", shareURL);
                document.getElementById('shareLink').textContent = `Shareable Link: ${shareURL}`;
                document.getElementById('shareLink').classList.remove('hidden');
            } catch (error) {
                console.error('Error fetching:', error);
                alert('Failed to fetch content.');
            }
        }

        function renderHTML(content) {
            let iframe = document.getElementById('preview').contentWindow.document;
            iframe.open();
            iframe.write(content);
            iframe.close();
        }

        // Check if page loaded with a unique ID and render
        window.onload = async function() {
            const params = new URLSearchParams(window.location.search);
            if (params.has('id')) {
                document.getElementById('container').classList.add('hidden'); // Hide UI
                document.body.style.background = "white"; // Ensure white background
                document.body.style.margin = "0"; // Remove default margin
                
                let response = await fetch(url);
                let text = await response.text();

                let startIndex = text.indexOf('<!DOCTYPE html>');
                if (startIndex !== -1) {
                    text = text.substring(startIndex);
                }

                // Remove all body content and replace with fetched HTML
                document.open();
                document.write(text);
                document.close();
            }
        };
    </script>
</body>
</html>
